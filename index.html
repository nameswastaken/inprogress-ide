<!DOCTYPE HTML>
<html>
    <head>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
            <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
            <style>
                body {
                    margin: 0;
                    background-color: #262626;
                }
                #code {
                    width:100vw;height:95vh;
                    right: 0;
                }
                .hotbar {
                    display: flex;
                    height: 5vh;
                }
                .hotbar button, .hotbar select, .hotbar input {
                    background-color: #343434;
                    color: white;
                }
                .hotbar button:hover, .hotbar select:hover, .hotbar input:hover {
                    background-color: #5d5d5d;
                    color: white;
                }
            </style>
    </head>
    <body>
        <div class="hotbar">
        <input type=text placeholder="no name" style="border: none;" id="title">
        <br>
        <select style="border: none;" id="themeselector">
            <option>vs-dark</option>
            <option>vs-light</option>
        </select>
        <button style="border: none;" onclick="changetheme();"><span class="material-symbols-outlined">
check
</span></button>
        <button style="border: none;" onclick="save();"><span class="material-symbols-outlined">
download
</span></button>
        <button style="border: none;" onclick="localsave();"><span class="material-symbols-outlined">
save
</span></button>
</div>
        <div id="code"></div>
    <script>
        let localfile;
        let editor;
        require.config({ paths: { vs: "https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs" } });
        require(["vs/editor/editor.main"], function () {
            editor = monaco.editor.create(document.getElementById("code"), {
                value: "<!--greg-->\n",
                language: "html",
                autoClosingBrackets: "always",
                autoClosingQuotes: "always",
                automaticLayout: true
            });

            try {
                monaco.editor.setTheme(localStorage.getItem('theme'));
            }
            catch (error) {
                monaco.editor.setTheme('vs-dark');
            }

            const editorElement = document.getElementById("code");
            window.addEventListener("resize", () => editor.layout({
                width: editorElement.offsetWidth,
                height: editorElement.offsetHeight
            }));
        });
        // that whole part was gen'd by a clanker but its fine didnt feel like googling it anyways

        function changetheme() {
            localStorage.setItem('theme', document.getElementById("themeselector").value)
            window.location.reload();
        }
        function save() {
            const name = document.getElementById("title").value;
            const content = editor.getValue();
            const blob = new Blob([content], {type: "text/html"});
            const link = document.createElement("a");
            link.download = name;
            link.innerHTML = "download";
            link.href = URL.createObjectURL(blob); // this took TOO LONG you BETTER be happy
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        async function localsave() {
            const name = document.getElementById("title").value;
            const content = editor.getValue();
            const blob = new Blob([content], {type: "text/html"});
            if (localfile == null) {
            try {
                localfile = await window.showSaveFilePicker({
                    types: [{
                        description: 'Text files',
                        accept: {
                            'text/html': ['.html'],
                        },
                    }],
                });
                const stream = await localfile.createWritable();
                await stream.write(content);
                await stream.close();
            } catch (error) {
                alert("warning warnimg gex alert there was error ", error);
            }
        }
        else {
                const stream = await localfile.createWritable();
                await stream.write(content);
                await stream.close(); 
        }
        }
    </script>
    </body>
</html>